
<%-
#
# Neurohub Project
#
# Copyright (C) 2019-2020
# The Royal Institution for the Advancement of Learning
# McGill University
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
#
-%>


<% title 'New Message' %>
<div class="nh_content">
  <div class="nh_form">
    <%= error_messages_for @nh_project, :header_message => "Project could not be created." %>
    <p class="nh_form_title">Send Message</p>

<%= form_for @message, :as => :message, :url => { :action => "create" }, :datatype => "script" do |f| -%>

      <fieldset>
     To users of project: <%= group_select(:group_id,
           {
             :groups  => current_user.assignable_groups.order(:name),
             :selector => @group_id, # :group_id is not an attribute of Message.
           },
           { :include_blank => true }
           )
      %>
      </fieldset>

<%# todo serge get feedback the need for that field with team %>
      <fieldset>
        <%= f.label :send_email, "Send E-mail" %>
        <%= check_box_tag "message[send_email]", 1, false %>
      </fieldset>

      <fieldset>
        <%= f.label :header %>
        <%= f.text_field :header, :size => 92 %>
      </fieldset>
      <fieldset>
        <%= f.label :description, 'Brief Topic Description' %>
        <%= f.text_area :description, :rows => 5, :cols => 80 %>
      </fieldset>
      <fieldset>
        <%= f.label :variable_text, 'Message' %>
        <%= f.text_area :variable_text, :rows => 5, :cols => 80 %>
      </fieldset>
      <fieldset>
        <%= f.label :expiry_date, "Expiration date (current time: #{to_localtime(Time.now, :datetime)})" %><br>
        <%=
          text_field_tag :expiry_date,
                         (@message.expiry ? "#{@message.expiry.strftime("%d/%m/%G")}" : ""),
                         :class => "datepicker"
         %>
        <%=
           select_tag :expiry_hour, options_for_select((0..23).map { |i| sprintf("%2.2d",i) }, @message.expiry ? @message.expiry.strftime("%H") : "")
        %>
        <%=
          select_tag :expiry_min,  options_for_select((0..59).step(15).map { |i| sprintf("%2.2d",i) }, @message.expiry ? @message.expiry.strftime("%M") : "")
        %>
        </fieldset>
        <br>

      <%= f.submit "Submit" %>
    </p>
  </div>
<% end %>
  </div>
</div>